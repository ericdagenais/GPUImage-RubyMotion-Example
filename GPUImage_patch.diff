From a12510ed84886e5e9937c268623b94b381650376 Mon Sep 17 00:00:00 2001
From: Eric Dagenais <eric@hoolako.com>
Date: Mon, 21 May 2012 00:22:31 -0700
Subject: [PATCH] -patch GPUImage with RubyMotion workarounds

---
 vendor/GPUImage/Source/GLProgram.h      |    1 +
 vendor/GPUImage/Source/GLProgram.m      |    5 +++++
 vendor/GPUImage/Source/GPUImageFilter.h |    3 +++
 vendor/GPUImage/Source/GPUImageFilter.m |    6 ++++++
 4 files changed, 15 insertions(+), 0 deletions(-)

diff --git a/vendor/GPUImage/Source/GLProgram.h b/vendor/GPUImage/Source/GLProgram.h
index 81a1a8d..c97f7bb 100755
--- a/vendor/GPUImage/Source/GLProgram.h
+++ b/vendor/GPUImage/Source/GLProgram.h
@@ -24,6 +24,7 @@
 - (void)addAttribute:(NSString *)attributeName;
 - (GLuint)attributeIndex:(NSString *)attributeName;
 - (GLuint)uniformIndex:(NSString *)uniformName;
+- (NSNumber *)uniformIndex2:(NSString *)uniformName; // RubyMotion workaround
 - (BOOL)link;
 - (void)use;
 - (NSString *)vertexShaderLog;
diff --git a/vendor/GPUImage/Source/GLProgram.m b/vendor/GPUImage/Source/GLProgram.m
index 4f4a2ff..0379d32 100755
--- a/vendor/GPUImage/Source/GLProgram.m
+++ b/vendor/GPUImage/Source/GLProgram.m
@@ -148,6 +148,11 @@ typedef void (*GLLogFunction) (GLuint program,
 {
     return glGetUniformLocation(program, [uniformName UTF8String]);
 }
+// Ruby motion workaround
+- (NSNumber *)uniformIndex2:(NSString *)uniformName
+{
+    return [NSNumber numberWithUnsignedInt:glGetUniformLocation(program, [uniformName UTF8String])];
+}
 // END:indexmethods
 #pragma mark -
 // START:link
diff --git a/vendor/GPUImage/Source/GPUImageFilter.h b/vendor/GPUImage/Source/GPUImageFilter.h
index a825509..e895c23 100755
--- a/vendor/GPUImage/Source/GPUImageFilter.h
+++ b/vendor/GPUImage/Source/GPUImageFilter.h
@@ -87,4 +87,7 @@ typedef struct GPUMatrix3x3 GPUMatrix3x3;
 - (void)setFloatVec4:(GLfloat *)newVec4 forUniform:(NSString *)uniformName;
 - (void)setFloatArray:(GLfloat *)array length:(GLsizei)count forUniform:(NSString*)uniformName;
 
+// Accessors
+- (GLProgram *)filterProgram; // RubyMotion workaround
+
 @end
\ No newline at end of file
diff --git a/vendor/GPUImage/Source/GPUImageFilter.m b/vendor/GPUImage/Source/GPUImageFilter.m
index 4d65275..d02810b 100755
--- a/vendor/GPUImage/Source/GPUImageFilter.m
+++ b/vendor/GPUImage/Source/GPUImageFilter.m
@@ -599,4 +599,10 @@ void dataProviderUnlockCallback (void *info, const void *data, size_t size)
 #pragma mark -
 #pragma mark Accessors
 
+// RubyMotion workaround
+- (GLProgram *)filterProgram
+{
+    return filterProgram;
+}
+
 @end
-- 
1.7.8.3

